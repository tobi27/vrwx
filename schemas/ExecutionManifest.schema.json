{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vrwx.io/schemas/ExecutionManifest.json",
  "title": "ExecutionManifest",
  "description": "Canonical manifest of job execution data. Used to deterministically compute qualityScore and workUnits.",
  "type": "object",
  "required": ["manifestVersion", "schemaVersion", "jobId", "robotId", "controller", "serviceType", "startTs", "endTs"],
  "additionalProperties": false,
  "properties": {
    "manifestVersion": {
      "type": "string",
      "const": "2.0",
      "description": "Manifest format version (M4.2)"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Schema version date (e.g., 2025-12-15)"
    },
    "serviceModuleVersion": {
      "type": "string",
      "description": "Service module version (e.g., 1.0)"
    },
    "jobId": {
      "type": "integer",
      "minimum": 1,
      "description": "On-chain job ID"
    },
    "robotId": {
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{64}$",
      "description": "Robot identifier (bytes32 hex)"
    },
    "controller": {
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{40}$",
      "description": "Robot controller address"
    },
    "serviceType": {
      "type": "string",
      "enum": ["inspection", "security_patrol", "delivery"],
      "description": "Type of service executed"
    },
    "startTs": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp when execution started"
    },
    "endTs": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp when execution ended"
    },
    "routeDigest": {
      "type": "string",
      "description": "Hash or digest of the route/path taken (optional)"
    },
    "artifacts": {
      "type": "array",
      "description": "List of artifacts produced during execution",
      "items": {
        "type": "object",
        "required": ["type", "sha256", "bytes"],
        "additionalProperties": false,
        "properties": {
          "type": {
            "type": "string",
            "description": "Artifact type (e.g., 'image', 'video', 'scan', 'report')"
          },
          "sha256": {
            "type": "string",
            "pattern": "^[a-fA-F0-9]{64}$",
            "description": "SHA-256 hash of the artifact"
          },
          "bytes": {
            "type": "integer",
            "minimum": 0,
            "description": "Size of artifact in bytes"
          }
        }
      }
    },
    "inspection": {
      "type": "object",
      "description": "Inspection-specific execution data",
      "additionalProperties": false,
      "properties": {
        "coverageVisited": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of coverage cells/points visited"
        },
        "coverageTotal": {
          "type": "integer",
          "minimum": 1,
          "description": "Total coverage cells/points required"
        },
        "anomaliesDetected": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of anomalies detected"
        }
      }
    },
    "patrol": {
      "type": "object",
      "description": "Security patrol-specific execution data",
      "additionalProperties": false,
      "properties": {
        "checkpointsRequired": {
          "type": "array",
          "description": "List of required checkpoint IDs",
          "items": {
            "type": "string"
          }
        },
        "checkpointsVisited": {
          "type": "array",
          "description": "List of actually visited checkpoint IDs",
          "items": {
            "type": "string"
          }
        },
        "dwellSeconds": {
          "type": "array",
          "description": "Dwell time at each visited checkpoint (parallel to checkpointsVisited)",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "minDwellRequired": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum dwell time required at each checkpoint (seconds)"
        }
      }
    },
    "delivery": {
      "type": "object",
      "description": "Delivery-specific execution data",
      "additionalProperties": false,
      "properties": {
        "pickupProofHash": {
          "type": "string",
          "pattern": "^0x[a-fA-F0-9]{64}$",
          "description": "Hash of pickup proof (photo, signature, etc.)"
        },
        "dropoffProofHash": {
          "type": "string",
          "pattern": "^0x[a-fA-F0-9]{64}$",
          "description": "Hash of dropoff proof (photo, signature, etc.)"
        },
        "pickupTs": {
          "type": "integer",
          "minimum": 0,
          "description": "Unix timestamp of pickup"
        },
        "dropoffTs": {
          "type": "integer",
          "minimum": 0,
          "description": "Unix timestamp of dropoff"
        }
      }
    }
  }
}
